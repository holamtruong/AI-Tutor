import{d as w,r as l,c as d,z as N,q as C,o as x,u as E,b as a,k as A,e as o,g as y,y as D,t as h,j as s,_ as L}from"./index-CblIsNI7.js";import{N as R}from"./Navbar-DwRIBrG9.js";import{A as V}from"./config-DlK2M2UR.js";import{h as j}from"./localStorage-gGBUY11W.js";const B={class:"dictionary-screen"},M={class:"dictionary-main dictionary-main--result"},O={class:"result-toolbar"},S=["disabled"],T={key:0},$={key:1},q={class:"dictionary-card result-card"},I={key:0,class:"result-card__header"},P={key:0},H={class:"result-card__body"},K={key:0,class:"status"},z={key:1,class:"status status--error"},J=["innerHTML"],Q={key:3,class:"status"},U=w({__name:"DictionaryResultView",setup(F){const _=E(),m=N(),r=l(null),p=l(!0),i=l(""),n=l(!1),u=l(null),c=d(()=>m.query.keyword??""),v=d(()=>m.query.context??""),f=d(()=>{var t,e;return((e=(t=r.value)==null?void 0:t.audioUrls)==null?void 0:e.us)??""});C(f,t=>{if(!t){u.value=null;return}const e=new Audio(t);e.addEventListener("ended",()=>{n.value=!1}),e.addEventListener("pause",()=>{n.value=!1}),u.value=e});const b=d(()=>r.value?`<div>${r.value.content.split(/\n{2,}/).map(e=>e.trim()).filter(Boolean).map(e=>e.replace(/\n/g,"<br />")).map(e=>`<p>${e}</p>`).join("")}</div>`:""),k=async()=>{if(u.value)try{n.value=!0,await u.value.play()}catch(t){console.error("Cannot play pronunciation audio",t),n.value=!1}},g=async()=>{if(!c.value){_.replace("/dictionary");return}try{p.value=!0,i.value="";const t=await fetch(`${V}/api/dictionary`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:c.value,context:v.value})});if(!t.ok)throw new Error(await t.text());const e=await t.json();r.value=e}catch(t){console.error("Dictionary lookup failed",t),i.value=t instanceof Error?t.message:"Không thể tra cứu từ điển, vui lòng thử lại."}finally{p.value=!1}};return x(()=>{if(!j()){_.replace("/");return}g()}),(t,e)=>(s(),a("div",B,[A(R),o("main",M,[o("header",O,[o("button",{class:"toolbar__btn toolbar__btn--ghost",type:"button",onClick:e[0]||(e[0]=G=>D(_).back())}," Quay lại "),e[1]||(e[1]=o("div",{class:"toolbar__spacer"},null,-1)),f.value?(s(),a("button",{key:0,class:"toolbar__btn",type:"button",disabled:n.value,onClick:k},[n.value?(s(),a("span",T,"Đang phát...")):(s(),a("span",$,"Nghe phát âm"))],8,S)):y("",!0)]),o("section",q,[c.value?(s(),a("header",I,[o("h1",null,h(c.value),1),v.value?(s(),a("p",P,"Ngữ cảnh: "+h(v.value),1)):y("",!0)])):y("",!0),o("div",H,[p.value?(s(),a("div",K,"Đang tra cứu...")):i.value?(s(),a("div",z,h(i.value),1)):r.value?(s(),a("article",{key:2,class:"result-content",innerHTML:b.value},null,8,J)):(s(),a("div",Q,"Không tìm thấy nội dung phù hợp."))])])])]))}}),ee=L(U,[["__scopeId","data-v-644fba75"]]);export{ee as default};
